<%- include("partials/header.ejs") %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game</title>
    <style>
        body {align-items: center;
        padding-top: 0px;}
    </style>
</head>
<body>
    <div class="container">
        <h1>Memory game</h1>
        <h2>Find pairs!</h2>
        <div class="game"></div>
        <button class="reset" onclick="window.location.reload();">Reset Game</button>
    </div>

    <% if(locals.data.topic) { %>
        <% var sendTopic = data.topic %>
        <% } %>
    
    <script>
const matches = {
    'ğŸ': 'epli',
    'ğŸ': 'pera',
    'ğŸŒ': 'banani',
    'ğŸŠ': 'appelsÃ­na',
    'ğŸ‹': 'sÃ­trÃ³na',
    'ğŸ“': 'jarÃ°arber',
    'ğŸ‡': 'vÃ­nber',
    'ğŸ’': 'kirsuber',
    'ğŸ§…': 'laukur',
    'ğŸ§„': 'hvÃ­tlaukur',
    'ğŸ¥”': 'kartafla',
    'ğŸ¥•': 'gulrÃ³t',
    'ğŸ¥’': 'gÃºrka',
    'ğŸ„': 'sveppur',
    'ğŸ¥¬': 'kÃ¡l',
    'ğŸ¥¦': 'brokkolÃ­',
    'â¤ï¸': 'rauÃ°ur',
    'ğŸ§¡': 'appelsÃ­nugulur',
    'ğŸ’›': 'gulur',
    'ğŸ’š': 'grÃ¦nn',
    'ğŸ’™': 'blÃ¡r',
    'ğŸ’œ': 'fjÃ³lublÃ¡r',
    'ğŸ¤': 'hvÃ­tur',
    'ğŸ–¤': 'svartur',
    'ğŸ': 'brauÃ°',
    'ğŸ§€': 'ostur',
    'ğŸ¥©': 'kjÃ¶t',
    'ğŸ•': 'pitsa',
    'ğŸŒ­': 'pylsa',
    'ğŸ¥ª': 'samloka',
    'ğŸ¥š': 'egg',
    'ğŸ¥›': 'mjÃ³lk',
    'ğŸ±': 'kÃ¶ttur',
    'ğŸ¶': 'hundur',
    'ğŸ“': 'kjÃºklingur',
    'ğŸ¦†': 'Ã¶nd',
    'ğŸ–': 'svÃ­n',
    'ğŸ': 'hestur',
    'ğŸ„': 'kÃº',
    'ğŸŸ': 'fiskur'
}

var topic = "<%=sendTopic%>";
if(topic==='fruits') {
    var emojis = ["ğŸ", "ğŸ", "ğŸ", "ğŸ", "ğŸŒ", "ğŸŒ", "ğŸŠ", "ğŸŠ", "ğŸ‹", "ğŸ‹", "ğŸ“", "ğŸ“", "ğŸ‡", "ğŸ‡", "ğŸ’", "ğŸ’"];
}
if(topic==='vegetables') {
    var emojis = ["ğŸ§…", "ğŸ§…", "ğŸ§„", "ğŸ§„", "ğŸ¥”", "ğŸ¥”", "ğŸ¥•", "ğŸ¥•", "ğŸ¥’", "ğŸ¥’", "ğŸ„", "ğŸ„", "ğŸ¥¬", "ğŸ¥¬", "ğŸ¥¦", "ğŸ¥¦"];
}
if(topic==='colours') {
    var emojis = ["â¤ï¸", "â¤ï¸", "ğŸ§¡", "ğŸ§¡", "ğŸ’›", "ğŸ’›", "ğŸ’š", "ğŸ’š", "ğŸ’™", "ğŸ’™", "ğŸ’œ", "ğŸ’œ", "ğŸ¤", "ğŸ¤", "ğŸ–¤", "ğŸ–¤"];
}
if(topic==='food') {
    var emojis = ["ğŸ", "ğŸ", "ğŸ§€", "ğŸ§€", "ğŸ¥©", "ğŸ¥©", "ğŸ•", "ğŸ•", "ğŸŒ­", "ğŸŒ­", "ğŸ¥ª", "ğŸ¥ª", "ğŸ¥š", "ğŸ¥š", "ğŸ¥›", "ğŸ¥›"];
}
if(topic==='animals') {
    var emojis = ["ğŸ±", "ğŸ±", "ğŸ¶", "ğŸ¶", "ğŸ“", "ğŸ“", "ğŸ¦†", "ğŸ¦†", "ğŸ–", "ğŸ–", "ğŸ", "ğŸ", "ğŸ„", "ğŸ„", "ğŸŸ", "ğŸŸ"];
}

var shuf_emojis = emojis.sort(() => (Math.random() > .5)  ? 2:-1);


for (let i=0; i<emojis.length ;i++) {
    let box = document.createElement('div');
    box.className = 'item';
    box.innerHTML = shuf_emojis[i];

    box.onclick = function() {
        this.classList.add('boxOpen');
        setTimeout(function(){
            if(document.querySelectorAll('.boxOpen').length > 1){
                if(document.querySelectorAll('.boxOpen')[0].innerHTML === document.querySelectorAll('.boxOpen')[1].innerHTML) {
                    document.querySelectorAll('.boxOpen')[0].classList.add('boxMatch');
                    document.querySelectorAll('.boxOpen')[1].classList.add('boxMatch');

                    let fruitEmoji = document.querySelectorAll('.boxOpen')[0].innerHTML;
                    if (fruitEmoji in matches) {
                        let fruitName = matches[fruitEmoji];
                        updateH2(fruitName);
                        playSoundMatch(fruitName);
                    } else {
                        console.log("Error with fruit name.")
                    }

                    document.querySelectorAll('.boxOpen')[1].classList.remove('boxOpen');
                    document.querySelectorAll('.boxOpen')[0].classList.remove('boxOpen');

                    if(document.querySelectorAll('.boxMatch').length == emojis.length) {
                        document.querySelector('h1').innerText = 'Well done!';
                    }
                    } else {
                        document.querySelectorAll('.boxOpen')[1].classList.remove('boxOpen');
                        document.querySelectorAll('.boxOpen')[0].classList.remove('boxOpen');
                    }
                }
        },500)
        document.querySelector('h2').innerText = 'Find more pairs!';
    }
    document.querySelector('.game').appendChild(box);
}

function playSoundMatch(fruitEmoji) {
    var audio = new Audio(`audio/${topic}/${fruitEmoji}.ogg`);
    audio.play();
}

function updateH2(fruitName) {
    document.querySelector('h2').innerText = fruitName;
}
    </script>
</body>
</html>