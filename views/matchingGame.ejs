<%- include("partials/header.ejs") %>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game</title>
    <style>
        body {align-items: center;
        padding-top: 0px;}
    </style>
</head>
<body>
    <% if(locals.data.topic) { %>
        <% var sendTopic = data.topic%>
        <% } %>

    <div class="container">
        <h1> <%=sendTopic%> </h1>
        <h2>Find pairs!</h2>
        <h3>Tries: 0</h3>
        <div class="game"></div>
        <button class="reset" onclick="window.location.reload();">Reset Game</button>
    </div>
    
    <% sendTopic = sendTopic.split(':')[0]; %>

    <% if (locals.matching_items) { %>
        <% var itemMatches = {}; %>
        <% for (let item of matching_items) { %>
            <% itemMatches[`${item.emoji}`] = `${item.icelandic}`%>
        <% } } %>

    <script>
const matches = JSON.parse('<%-JSON.stringify(itemMatches)%>');

var topic = "<%=sendTopic%>".toLowerCase();
if(topic==='fruits') {
    var emojis = ["ðŸŽ", "ðŸŽ", "ðŸ", "ðŸ", "ðŸŒ", "ðŸŒ", "ðŸŠ", "ðŸŠ", "ðŸ‹", "ðŸ‹", "ðŸ“", "ðŸ“", "ðŸ‡", "ðŸ‡", "ðŸ’", "ðŸ’"];
}
if(topic==='vegetables') {
    var emojis = ["ðŸ§…", "ðŸ§…", "ðŸ§„", "ðŸ§„", "ðŸ¥”", "ðŸ¥”", "ðŸ¥•", "ðŸ¥•", "ðŸ¥’", "ðŸ¥’", "ðŸ„", "ðŸ„", "ðŸ¥¬", "ðŸ¥¬", "ðŸ¥¦", "ðŸ¥¦"];
}
if(topic==='colours') {
    var emojis = ["â¤ï¸", "â¤ï¸", "ðŸ§¡", "ðŸ§¡", "ðŸ’›", "ðŸ’›", "ðŸ’š", "ðŸ’š", "ðŸ’™", "ðŸ’™", "ðŸ’œ", "ðŸ’œ", "ðŸ¤", "ðŸ¤", "ðŸ–¤", "ðŸ–¤"];
}
if(topic==='foods') {
    var emojis = ["ðŸž", "ðŸž", "ðŸ§€", "ðŸ§€", "ðŸ¥©", "ðŸ¥©", "ðŸ•", "ðŸ•", "ðŸŒ­", "ðŸŒ­", "ðŸ¥ª", "ðŸ¥ª", "ðŸ¥š", "ðŸ¥š", "ðŸ¥›", "ðŸ¥›"];
}
if(topic==='animals') {
    var emojis = ["ðŸ±", "ðŸ±", "ðŸ¶", "ðŸ¶", "ðŸ“", "ðŸ“", "ðŸ¦†", "ðŸ¦†", "ðŸ–", "ðŸ–", "ðŸŽ", "ðŸŽ", "ðŸ„", "ðŸ„", "ðŸŸ", "ðŸŸ"];
}

var shuf_emojis = emojis.sort(() => (Math.random() > .5)  ? 2:-1);
var tries = 0;

for (let i=0; i<emojis.length ;i++) {
    let box = document.createElement('div');
    box.className = 'item';
    box.innerHTML = shuf_emojis[i];

    box.onclick = function() {
        this.classList.add('boxOpen');
        setTimeout(function(){
            if(document.querySelectorAll('.boxOpen').length > 1){
                if(document.querySelectorAll('.boxOpen')[0].innerHTML === document.querySelectorAll('.boxOpen')[1].innerHTML) {
                    document.querySelectorAll('.boxOpen')[0].classList.add('boxMatch');
                    document.querySelectorAll('.boxOpen')[1].classList.add('boxMatch');

                    let fruitEmoji = document.querySelectorAll('.boxOpen')[0].innerHTML;
                    if (fruitEmoji in matches) {
                        let fruitName = matches[fruitEmoji];
                        updateH2(fruitName);
                        playSoundMatch(fruitName);
                    } else {
                        console.log("Error with fruit name.")
                    }

                    document.querySelectorAll('.boxOpen')[1].classList.remove('boxOpen');
                    document.querySelectorAll('.boxOpen')[0].classList.remove('boxOpen');

                    if(document.querySelectorAll('.boxMatch').length == emojis.length) {
                        document.querySelector('h1').innerText = 'Well done!';
                    }
                    } else {
                        document.querySelectorAll('.boxOpen')[1].classList.remove('boxOpen');
                        document.querySelectorAll('.boxOpen')[0].classList.remove('boxOpen');
                        tries ++;
                        updateTries(tries);
                    }
                }
        },500)
        document.querySelector('h2').innerText = 'Find more pairs!';
    }
    document.querySelector('.game').appendChild(box);
}

function playSoundMatch(fruitEmoji) {
    var audio = new Audio(`audio/${topic}/${fruitEmoji}.ogg`);
    audio.play();
}

function updateH2(fruitName) {
    document.querySelector('h2').innerText = fruitName;
}

function updateTries(tries) {
    document.querySelector('h3').innerText = `Tries: ${tries}`;
}
    </script>
</body>
</html>